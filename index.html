<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Tabela de Medidas e Cálculos Ecocardiográficos</title>
  <link rel="icon" type="image/x-icon" href="https://www.cardiodiagnostico.com.br/wp-content/themes/cardio1/img/favicon.png">
  <style>
    :root{
      --bg:#bdbfc4;
      --panel:#111827;
      --card:#1f2937;
      --muted:#c3c7cd;
      --text:#ffffff;
      --accent:#22c55e;
      --warn:#f59e0b;
      --danger:#ef4444;
      --info:#3b82f6;
      --ink:#ffffff;
      --text-input:#ffffff;
      --border:rgba(148,163,184,.25);
      --border-soft:rgba(148,163,184,.12);
    }
    a { text-decoration:none; color:#ffff }
    html, body { height:100% }
    body{
      margin:20px;
      font-family: Arial;
      font-size: 12pt;
      color: var(--text);
      background: var(--bg);
    }
    .logo{ width:25%; height:auto }
    h1{
      text-align:center;
      margin-top:0%;
      color: black;
      letter-spacing:.2px;
    }

    /* Container (card style) */
    #ecoContainer{
      width:100%;
      max-width:800px;
      margin:0 auto;
      background: rgba(31,41,55,.7);
      backdrop-filter: blur(6px);
      border:1px solid var(--border-soft);
      border-radius:18px;
      padding:16px;
    }

    /* Columns of inputs */
    .input-columns{
      display:flex;
      gap:14px;
      justify-content:center;
      margin-top:14px;
      flex-direction:column;
    }
    @media(min-width:700px){ .input-columns{ flex-direction:row } }

    .input-column{ flex:1; display:flex; flex-direction:column; gap:12px; }
    .input-field{ display:flex; flex-direction:column }
    .input-field label{
      margin-bottom:6px;
      font-size:18px;
      color: var(--muted);
      font-weight:600;
    }

    input, select, textarea{
      padding:10px 12px;
      font-size: 13pt;
      font-weight: bold;
      width:100%;
      box-sizing:border-box;
      color: var(--text-input);
      background: var(--ink);
      border:1px solid var(--border);
      border-radius:12px;
      outline:none;
    }
    input[type="number"]{ appearance:textfield }
    select{ height: fit-content }
    #vaeTipo{ width: fit-content }

    /* Actions / buttons */
    .actions{
      display:flex;
      justify-content:center;
      flex-wrap:wrap;
      margin-top:16px;
      gap:10px;
    }
    button{
      padding:12px 14px;
      font-size:12pt;
      cursor:pointer;
      border:0;
      border-radius:14px;
      background: rgb(112, 129, 142);
      color: var(--text);
      font-weight:700;
      transition: transform .02s ease-in-out, background .2s ease;
    }
    button:active{ transform: scale(.98) }
    .btn-primary{ background: var(--info) }
    .btn-success{ background: var(--accent) }
    .btn-warning{ background: var(--warn) }
    .btn-danger{ background: var(--danger) }
    /* ADICIONADO: estilo para o botão “VAE indexado à altura” */
    .btn-info{ background: rgb(112, 129, 142) }

    /* Inline alert */
    #alerta{
      text-align:center;
      margin-top:10px;
      font-weight:700;
      color: var(--accent);
      display:none;
    }

    /* Table (card look) */
    table{
      width:100%;
      border-collapse:collapse;
      margin-top:16px;
      font-size: 8pt;
      background: whitesmoke;
      border:1px solid var(--border-soft);
      border-radius:14px;
      overflow:hidden;
    }
    thead th{
      color: var(--muted);
      font-weight:700;
      background:whitesmoke;
      border-bottom:1px solid var(--border-soft);
    }
    tr + tr td{ border-top:1px solid var(--border-soft) }
    td, th{
      padding:4px;
      text-align:center;
      border:none;
      color: var(--text);
    }
    table tr:first-child{ border-top: 0 }
    table tr:last-child{ border-bottom: 0 }

    #resultado td{ text-align:left; padding-left:12px; padding-right:16px; }
    .muted{ color: var(--muted) }
    .hidden{ display:none }

    /* Espaçamento e título da tabela de altura */
    #resultadoAltura{
      margin-top: 40px;
      margin-bottom: 32px; /* em vez de auto */
    }
    #tituloAltura{
      text-align: center;
      font-size: 12pt;
      font-weight: 700;
      color: black;
      background-color: whitesmoke;
      margin-top: 30px;
      margin-bottom: 10px; /* título próximo da tabela */
    }

    /* Flags visuais para cortes */
.flag-abn{ color: var(--danger); font-weight: 800; }
.flag-ok{ color: var(--text); }

  </style>
</head>
<body>

  <a href="https://www.cardiodiagnostico.com.br/" target="_blank">
    <img src="https://www.cardiodiagnostico.com.br/wp-content/themes/cardio1/img/logo.png" alt="Cardiodiagnóstico" class="logo">
  </a>

  <h1>Tabela de Medidas e Cálculos Ecocardiográficos</h1>

  <div id="ecoContainer">
    <div class="input-columns">
      <div class="input-column">
        <div class="input-field">
          <label for="aorta">Aorta (mm)</label>
          <input type="number" id="aorta">
        </div>
        <div class="input-field">
          <label for="atrio">Átrio Esquerdo (mm)</label>
          <input type="number" id="atrio">
        </div>
        <div class="input-field">
          <label for="ventriculo">Ventrículo Direito (mm)</label>
          <input type="number" id="ventriculo">
        </div>
        <div class="input-field">
          <label for="ddve">Diâmetro Diastólico VE (mm)</label>
          <input type="number" id="ddve">
        </div>
        <div class="input-field">
          <label for="dsve">Diâmetro Sistólico VE (mm)</label>
          <input type="number" id="dsve">
        </div>
        <div class="input-field">
          <label for="septo">Septo (mm)</label>
          <input type="number" id="septo">
        </div>
        <div class="input-field">
          <label for="parede">Parede Posterior (mm)</label>
          <input type="number" id="parede">
        </div>
      </div>

      <div class="input-column">
        <div class="input-field">
          <label for="fc">Frequência Cardíaca (bpm)</label>
          <input type="number" id="fc">
        </div>
        <div class="input-field">
          <label for="peso">Peso (kg)</label>
          <input type="number" id="peso">
        </div>
        <div class="input-field">
          <label for="altura">Altura (cm)</label>
          <input type="number" id="altura">
        </div>
        <div class="input-field">
          <label for="vae">Volume do Átrio Esquerdo</label>
          <div style="display:flex; gap:8px;">
            <input type="text" id="vae">
            <select id="vaeTipo" style="flex:1;">
              <option selected="selected" value="ml/m²">ml/m²</option>
              <option value="ml">ml</option>
            </select>
          </div>
        </div>
        <div class="input-field">
          <label for="vdf">Volume Diastólico Final do VE (ml) (opcional)</label>
          <input type="number" id="vdf">
        </div>
        <div class="input-field">
          <label for="vsf">Volume Sistólico Final do VE (ml) (opcional)</label>
          <input type="number" id="vsf">
        </div>
        <div class="input-field">
          <label for="metodoSelect">Método:</label>
          <select id="metodoSelect">
            <option value="">Teichholz</option>
            <option value="AFI">AFI</option>
            <option value="Simpson">Simpson</option>
            <option value="AutoEF">AutoEF</option>
            <option value="Heart Model">Heart Model</option>
            <option value="4D LVQ">4D LVQ</option>
          </select>
        </div>
      </div>
    </div>

    <div class="actions">
      <button id="calcularBtn" type="button" class="btn-success">Calcular</button>
      <button type="button" onclick="copiarTabela()" class="btn-primary">Copiar</button>
      <button type="button" onclick="limparFormulario()" class="btn-warning">Limpar</button>
    </div>

    <div id="alerta"></div>
  </div>

  <div class="actions">
    <button type="button"><a href="https://fmsegat.github.io/cmph.html">Checklist CMPH</a></button>
    <button type="button"><a href="https://fmsegat.github.io/teer.html">Checklist TEER</a></button>
    <button type="button"><a href="https://fmsegat.github.io/stress-echo-abcde.html">Estresse</a></button>
    <button type="button"><a href="https://fmsegat.github.io/wilkins_EM.html">Escore Wilkins</a></button>
    <!-- Botão para índice por altura -->
    <button type="button" id="calcAlturaBtn" class="btn-info">VAE indexado à altura (IMC&gt;30)</button>
  </div>

  <!-- Tabela principal -->
  <table id="resultado"></table>

  <!-- Tabela de referência para obesos -->
  <h2 id="tituloAltura" class="hidden">Avaliação do volume atrial em obesos (apenas para consulta/referência)</h2>
  <table id="resultadoAltura" class="hidden"></table>

  <script>
    function getCssVar(name, el = document.documentElement) {
      return getComputedStyle(el).getPropertyValue(name).trim();
    }
    function setCssVar(name, value, el = document.documentElement) {
      el.style.setProperty(name, value);
    }
  
    const ecoContainer   = document.getElementById('ecoContainer');
    const tabela         = document.getElementById('resultado');
    const calcularBtn    = document.getElementById('calcularBtn');
    const calcAlturaBtn  = document.getElementById('calcAlturaBtn');
    const tabelaAltura   = document.getElementById('resultadoAltura');
    const tituloAlturaEl = document.getElementById('tituloAltura');
  
    calcAlturaBtn.addEventListener('click', calcularIndexAltura);
    calcularBtn.addEventListener('click', calcular);
  
    /* ---- utilitário: oculta e limpa a tabela de obesos ---- */
    function hideAlturaTable(){
      if (tabelaAltura){
        tabelaAltura.innerHTML = '';
        tabelaAltura.classList.add('hidden');
      }
      if (tituloAlturaEl){
        tituloAlturaEl.classList.add('hidden');
      }
    }
  
    /* ---- cálculo por altura (para IMC > 30) + flags ---- */
    function calcularIndexAltura() {
      const alerta   = document.getElementById('alerta');
  
      // Ler campos necessários
      const peso     = +document.getElementById('peso').value.replace(',', '.');
      const alturaCm = +document.getElementById('altura').value.replace(',', '.');
      const vaeStr   = document.getElementById('vae').value.replace(',', '.');
      const vaeTipo  = document.getElementById('vaeTipo').value;
  
      if (!peso || !alturaCm) {
        mostraAlerta("Informe peso e altura.", "red");
        return;
      }
      const alturaM = alturaCm / 100;
  
      // DuBois (altura em cm)
      const sc  = 0.007184 * Math.pow(peso, 0.425) * Math.pow(alturaCm, 0.725);
      const imc = peso / Math.pow(alturaM, 2);
  
      if (!vaeStr) {
        mostraAlerta("Informe o volume do átrio esquerdo (VAE).", "red");
        return;
      }
      const vaeNum = +vaeStr;
      if (Number.isNaN(vaeNum)) {
        mostraAlerta("VAE inválido.", "red");
        return;
      }
  
      // Converte VAE absoluto vs indexado por SC
      const vae_indexado = (vaeTipo === "ml") ? vaeNum / sc : vaeNum;   // ml/m²
      const vae_ml       = (vaeTipo === "ml/m²") ? vaeNum * sc : vaeNum; // ml
  
      // Recomendação para obesos (IMC>30)
      if (imc <= 30) {
        mostraAlerta(`IMC = ${imc.toFixed(1).replace('.', ',')} (≤ 30). Este índice é recomendado para obesos.`, "orange");
        return;
      }
  
      // Índices por altura
      const idx_h   = vae_ml / alturaM;                 // ml/m
      const idx_h27 = vae_ml / Math.pow(alturaM, 2.7);  // ml/m^2.7
  
      // Cut-offs (geral)
      const cut_h   = 29;   // ml/m
      const cut_h27 = 16;   // ml/m^2.7
  
      // Monta linhas + flags
      const linhas = [
        { rotulo: "Parâmetro", valor: "Valor", ref: "Unidade / Referência", header: true },
        { rotulo: "VAE (absoluto)", valor: vae_ml.toFixed(1).replace('.', ','), ref: "♂ < 58 ml  ♀ < 52 ml" },
        { rotulo: "VAE/altura", valor: idx_h.toFixed(1).replace('.', ','), ref: "Normal: < 29 ml/m", flag: (idx_h > cut_h) },
        { rotulo: "VAE/altura²·⁷", valor: idx_h27.toFixed(1).replace('.', ','), ref: "Normal: < 16 ml/m²·⁷", flag: (idx_h27 > cut_h27) },
      ];
  
      renderTabelaAltura(linhas);
      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
  
      function renderTabelaAltura(rows) {
        tabelaAltura.innerHTML = "";
        tabelaAltura.classList.remove("hidden");
        tituloAlturaEl.classList.remove("hidden");
  
        rows.forEach((r) => {
          const tr = document.createElement('tr');
  
          const c1 = r.header ? document.createElement('th') : document.createElement('td');
          const c2 = r.header ? document.createElement('th') : document.createElement('td');
          const c3 = r.header ? document.createElement('th') : document.createElement('td');
  
          c1.textContent = r.rotulo;
          c2.textContent = r.valor;
          c3.textContent = r.ref;
  
          // Aplica flag visual se ultrapassar corte (apenas nas linhas com flag)
          if (!r.header && r.flag !== undefined) {
            if (r.flag) {
              c2.classList.add('flag-abn');
            } else {
              c2.classList.add('flag-ok');
            }
          }
  
          tr.appendChild(c1); tr.appendChild(c2); tr.appendChild(c3);
          tabelaAltura.appendChild(tr);
        });
      }
  
      function mostraAlerta(msg, cor = "green") {
        alerta.textContent = msg;
        alerta.style.display = "block";
        alerta.style.color = (cor === "orange") ? "#f59e0b" : cor;
        setTimeout(() => alerta.style.display = "none", 2500);
      }
    }
  
    /* ---- cálculo principal: apaga tabela de obesos antes de calcular ---- */
    function calcular() {
      // 1) se a tabela de obesos estiver aberta, limpa/oculta
      hideAlturaTable();
  
      const aorta = +document.getElementById('aorta').value.replace(',', '.');
      const atrio = +document.getElementById('atrio').value.replace(',', '.');
      const ventriculo = +document.getElementById('ventriculo').value.replace(',', '.');
      const ddve = +document.getElementById('ddve').value.replace(',', '.');
      const dsve = +document.getElementById('dsve').value.replace(',', '.');
      const septo = +document.getElementById('septo').value.replace(',', '.');
      const parede = +document.getElementById('parede').value.replace(',', '.');
      const fc = +document.getElementById('fc').value.replace(',', '.');
      const peso = +document.getElementById('peso').value.replace(',', '.');
      const altura = +document.getElementById('altura').value.replace(',', '.'); // cm
      const vdf_in = document.getElementById('vdf').value.replace(',', '.');
      const vsf_in = document.getElementById('vsf').value.replace(',', '.');
      const vaeInputRaw = document.getElementById('vae').value.replace(',', '.');
      let vaeTipo = document.getElementById('vaeTipo').value;
      const metodoSel = document.getElementById('metodoSelect').value;
  
      // SC (DuBois) com altura em cm
      const sc  = 0.007184 * Math.pow(peso, 0.425) * Math.pow(altura, 0.725);
      const imc = peso / Math.pow((altura / 100), 2);
  
      function teichholz(d) {
        // d em mm -> cm ao dividir por 10; retorna ml/m²
        return ((7.0 / (2.4 + (d / 10))) * Math.pow((d / 10), 3)) / sc;
      }
  
      let vdf, vsf, metodo = "Teichholz";
      if (!vdf_in || !vsf_in) {
        vdf = teichholz(ddve);
        vsf = teichholz(dsve);
      } else {
        vdf = (+vdf_in) / sc; // ml/m²
        vsf = (+vsf_in) / sc; // ml/m²
        metodo = metodoSel || "Manual";
      }
  
      const fe  = ((vdf - vsf) / vdf) * 100;
      const ve  = vdf - vsf;
      const ic  = (fc * ve) / 1000; // L/min/m²
      const imve = (0.8 * (1.04 * (Math.pow((ddve/10 + septo/10 + parede/10), 3) - Math.pow((ddve/10), 3))) + 0.6) / sc;
      const er  = (2 * parede) / ddve;
      const metodoTexto = metodo !== "Teichholz" ? `(${metodo})` : "(Teichholz)";
  
      // VAE exibido sempre em ml/m² na tabela principal
      let vaeDisp = vaeInputRaw;
      const vae_tipo_display = "ml/m²";
      if (vaeTipo === "ml") {
        const val = (+vaeInputRaw) / sc;
        vaeDisp = isFinite(val) ? val.toFixed(1) : '';
      }
      vaeDisp = (vaeDisp || '').toString().replace('.', ',');
  
      const dados = [
        ["Aorta", aorta, "mm", `Fração de Ejeção ${metodoTexto}`, fe.toFixed(1).replace('.', ','), "%"],
        ["Átrio Esquerdo", atrio, "mm", `Volume Diastólico Final ${metodoTexto}`, vdf.toFixed(1).replace('.', ','), "ml/m²"],
        ["Ventrículo Direito", ventriculo, "mm", `Volume Sistólico Final ${metodoTexto}`, vsf.toFixed(1).replace('.', ','), "ml/m²"],
        ["Diâmetro Diastólico VE", ddve, "mm", "Volume Ejetado/batimento", ve.toFixed(1).replace('.', ','), "ml/m²"],
        ["Diâmetro Sistólico VE", dsve, "mm", "Índice Cardíaco", ic.toFixed(1).replace('.', ','), "L/min/m²"],
        ["Septo", septo, "mm", "Índice de Massa do VE", imve.toFixed(1).replace('.', ','), "g/m²"],
        ["Parede Posterior", parede, "mm", "Espessura relativa", er.toFixed(2).replace('.', ','), ""],
        ["Frequência cardíaca", fc, "bpm", "Superfície corporal (Dubois)", sc.toFixed(2).replace('.', ','), "m²"],
        ["Peso", peso, "kg", "Índice de Massa Corpórea", imc.toFixed(1).replace('.', ','), "kg/m²"],
        ["Altura", altura, "cm", "Volume do Átrio Esquerdo", vaeDisp, vae_tipo_display]
      ];
  
      tabela.innerHTML = '';
      dados.forEach(linha => {
        const tr = document.createElement('tr');
        linha.forEach(cel => {
          const td = document.createElement('td');
          td.textContent = cel;
          tr.appendChild(td);
        });
        tabela.appendChild(tr);
      });
  
      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }
  
    function copiarTabela() {
      const alerta = document.getElementById("alerta");
      if (!tabela.innerText.trim()) {
        alerta.textContent = "Nenhum resultado para copiar.";
        alerta.style.display = "block";
        alerta.style.color = "red";
        setTimeout(() => alerta.style.display = "none", 2000);
        return;
      }
      const corOriginal = getComputedStyle(document.documentElement).getPropertyValue('--text').trim();
      document.documentElement.style.setProperty('--text', 'black');
  
      const range = document.createRange();
      range.selectNode(tabela);
      const selection = window.getSelection();
      selection.removeAllRanges();
      selection.addRange(range);
  
      try {
        document.execCommand('copy');
        alerta.textContent = "Tabela copiada para a área de transferência.";
        alerta.style.color = "green";
      } catch (err) {
        alerta.textContent = "Erro ao copiar a tabela.";
        alerta.style.color = "red";
      }
  
      alerta.style.display = "block";
      setTimeout(() => alerta.style.display = "none", 2000);
      selection.removeAllRanges();
      document.documentElement.style.setProperty('--text', corOriginal);
    }
  
    function limparFormulario() {
      // limpar inputs e selects
      ecoContainer.querySelectorAll('input').forEach(input => input.value = '');
      ecoContainer.querySelector('#metodoSelect').value = '';
      ecoContainer.querySelector('#vaeTipo').value = 'ml/m²';
  
      // limpar tabela principal
      tabela.innerHTML = '';
  
      // limpar/ocultar tabela de obesos
      hideAlturaTable();
  
      // esconder alerta
      const alerta = document.getElementById("alerta");
      alerta.style.display = "none";
    }
  
    // Avançar para próximo input ao pressionar Enter
    const formElements = ecoContainer.querySelectorAll('input, select');
    formElements.forEach((el, index) => {
      el.addEventListener('keydown', function (e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          const nextEl = formElements[index + 1];
          if (nextEl) nextEl.focus();
          else calcularBtn.focus();
        }
      });
    });
  </script>
</body>
</html>
